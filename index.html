<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>539 æ•¸æ“šæ ¸å¿ƒ v4.0</title>
    <style>
        :root { --bg: #0a192f; --card: #172a45; --gold: #c5a059; --cyan: #64ffda; --text: #e6f1ff; }
        
        /* iOS å…¨æ»¿ç‰ˆå„ªåŒ– */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background-color: var(--bg); color: var(--text); 
            margin: 0; padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom);
            display: flex; flex-direction: column; height: 100vh; width: 100vw;
            overflow: hidden; 
        }

        .header { padding: 15px; text-align: center; flex-shrink: 0; }
        .header h1 { font-size: 1.1rem; color: var(--gold); margin: 0; letter-spacing: 1px; }
        
        .scroll-area { 
            flex-grow: 1; overflow-y: auto; padding: 10px 15px;
            -webkit-overflow-scrolling: touch; /* iOS å¹³æ»‘æ»¾å‹• */
        }

        .upload-box { 
            background: rgba(197, 160, 89, 0.1); border: 1.5px dashed var(--gold); 
            border-radius: 12px; padding: 15px; text-align: center; margin-bottom: 15px; 
        }

        /* ç­–ç•¥å¡ç‰‡é©é… */
        .strat-card { 
            background: var(--card); border-radius: 16px; padding: 16px; 
            margin-bottom: 12px; border-left: 5px solid var(--gold);
            width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .strat-info { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .strat-name { font-weight: bold; font-size: 0.95rem; color: var(--gold); }
        .strat-desc { font-size: 0.75rem; color: #8892b0; margin-top: 4px; }
        .strat-rate { font-size: 0.8rem; color: var(--cyan); text-align: right; line-height: 1.4; }

        /* çƒé«” iOS é©é…å¤§å° */
        .ball-row { display: flex; gap: 8px; justify-content: space-between; }
        .ball { 
            width: 18%; aspect-ratio: 1/1; background: var(--gold); 
            border-radius: 50%; color: var(--bg); 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 800; font-size: 1.2rem; 
        }

        /* åº•éƒ¨æŒ‰éˆ• iOS å–®æ‰‹ç†±å€ */
        .footer { 
            padding: 15px 20px calc(15px + env(safe-area-inset-bottom)); 
            background: linear-gradient(transparent, var(--bg) 50%);
            flex-shrink: 0;
        }
        .main-btn { 
            width: 100%; padding: 18px; border-radius: 40px; border: none; 
            background: var(--gold); color: var(--bg); 
            font-size: 1.1rem; font-weight: bold; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        .main-btn:active { transform: scale(0.97); opacity: 0.9; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="header"><h1>539 ç²¾è‹±å›æ¸¬æ ¸å¿ƒ v4.0</h1></div>

<div class="scroll-area">
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <span style="color: var(--gold); font-size: 0.9rem;">ğŸ“‚ é»æ“Šè¼‰å…¥ CSV (è‡ªå‹•é©é… iOS)</span>
        <input type="file" id="fileInput" accept=".csv" onchange="processData(this)">
    </div>
    <div id="results"></div>
</div>

<div class="footer">
    <button id="runBtn" class="main-btn" onclick="render()" disabled>è¨ˆç®—ä¸¦ç”¢å‡ºæœ€å„ªç‰Œçµ„</button>
</div>

<script>
    let history = [];
    let stats = { hot: [], missing: [], neighbors: [], weighted: [] };
    let backtestRates = {};

    function processData(input) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            history = lines.map(l => l.split(',').map(v => parseInt(v.trim())).filter(n => n >= 1 && n <= 39)).filter(a => a.length === 5);
            if (history.length > 5) {
                analyze();
                runBT();
                document.getElementById('runBtn').disabled = false;
                render();
            }
        };
        reader.readAsText(input.files[0]);
    }

    function analyze() {
        let counts = {}, lastSeen = {};
        for(let i=1; i<=39; i++) { counts[i] = 0; lastSeen[i] = history.length; }
        
        history.forEach((draw, index) => {
            draw.forEach(n => {
                counts[n]++;
                if (lastSeen[n] === history.length) lastSeen[n] = index;
            });
        });

        // 1. é«˜é »ç†±é–€
        stats.hot = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0, 10).map(i=>parseInt(i[0]));
        
        // 2. éºæ¼å›è£œ (æœ€ä¹…æœªé–‹)
        stats.missing = Object.entries(lastSeen).sort((a,b)=>b[1]-a[1]).slice(0, 10).map(i=>parseInt(i[0]));

        // 3. é„°è™Ÿé—œè¯ (ç†±è™Ÿå·¦å³)
        let top1 = stats.hot[0];
        let n1 = top1 - 1 < 1 ? 39 : top1 - 1;
        let n2 = top1 + 1 > 39 ? 1 : top1 + 1;
        stats.neighbors = [top1, n1, n2, stats.hot[1], stats.hot[2]];

        // 4. å¤§æ•¸æ“šåŠ æ¬Š
        stats.weighted = stats.hot.slice(0, 3).concat(stats.missing.slice(0, 2));
    }

    function runBT() {
        ['missing', 'hot', 'neighbors', 'weighted'].forEach(type => {
            const pick = getPick(type);
            let hits = 0, range = Math.min(100, history.length-1);
            for(let i=1; i<=range; i++) {
                if (pick.filter(n => history[i].includes(n)).length >= 2) hits++;
            }
            backtestRates[type] = ((hits / range) * 100).toFixed(2);
        });
    }

    function getPick(type) {
        if (type === 'missing') return stats.missing.slice(0, 5);
        if (type === 'hot') return stats.hot.slice(0, 5);
        if (type === 'neighbors') return stats.neighbors;
        return stats.weighted;
    }

    function render() {
        const container = document.getElementById('results');
        const confs = [
            { id: 'missing', name: 'éºæ¼å›è£œ (æ•¸æ“šè£œå„Ÿ)', desc: 'é¸å–æ­·å²éºæ¼å€¼æœ€é«˜è™Ÿç¢¼' },
            { id: 'hot', name: 'é«˜é »æœ€å„ª (Top 5)', desc: 'å›ºå®šé–å®šå‡ºç¾é »ç‡æœ€é«˜çµ„åˆ' },
            { id: 'neighbors', name: 'é„°è™Ÿé—œé€£ (ç†±è™Ÿæ“´æ•£)', desc: 'æ ¹æ“šæœ€å¼·ç†±è™ŸåŠå…¶é„°ä½æ¨ç®—' },
            { id: 'weighted', name: 'å…¨é‡åŠ æ¬Š (å»éš¨æ©Ÿ)', desc: 'ç¶œåˆé »ç‡èˆ‡å›è£œå‹•èƒ½æœ€é«˜åˆ†' }
        ];
        container.innerHTML = confs.map(c => `
            <div class="strat-card">
                <div class="strat-info">
                    <div><div class="strat-name">${c.name}</div><div class="strat-desc">${c.desc}</div></div>
                    <div class="strat-rate">å›æ¸¬ç‡<br><b style="color:var(--cyan)">${backtestRates[c.id]}%</b></div>
                </div>
                <div class="ball-row">${getPick(c.id).sort((a,b)=>a-b).map(n=>`<div class="ball">${n<10?'0'+n:n}</div>`).join('')}</div>
            </div>
        `).join('');
    }
</script>
</body>
</html>
