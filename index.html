<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 æ•¸æ“šåˆ†æç³»çµ± v14.0</title>
    <style>
        :root { --bg: #0a192f; --card: #172a45; --gold: #c5a059; --cyan: #64ffda; --text: #e6f1ff; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 15px; box-sizing: border-box; }
        h2 { font-size: 0.9rem; color: var(--gold); margin-bottom: 12px; border-left: 3px solid var(--gold); padding-left: 8px; }
        .panel { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #233554; }
        
        /* Panel 1 & 2 */
        .upload-btn { width: 100%; padding: 15px; background: rgba(197, 160, 89, 0.1); border: 1px dashed var(--gold); border-radius: 8px; color: var(--gold); cursor: pointer; font-weight: bold; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { text-align: center; }
        .stat-val { font-size: 1.2rem; font-weight: bold; color: var(--cyan); }

        /* Panel 3: Log Table */
        .log-ctrl { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        select { background: var(--bg); color: var(--gold); border: 1px solid var(--gold); padding: 5px; border-radius: 5px; font-size: 0.8rem; }
        table { width: 100%; border-collapse: collapse; font-size: 0.7rem; }
        th { color: var(--gold); border-bottom: 1px solid #233554; padding: 5px; text-align: left; }
        td { padding: 8px 5px; border-bottom: 1px solid #0a192f; }
        .hit { color: var(--cyan); font-weight: bold; }

        /* Panel 4: Strategy Cards */
        .strat-card { background: var(--bg); border-radius: 10px; padding: 12px; margin-bottom: 10px; border-left: 4px solid var(--gold); }
        .strat-header { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 8px; }
        .ball-row { display: flex; gap: 6px; }
        .ball { width: 35px; height: 35px; background: var(--gold); border-radius: 50%; color: var(--bg); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; }

        .main-btn { width: 100%; padding: 18px; border-radius: 30px; border: none; background: var(--gold); color: var(--bg); font-weight: bold; font-size: 1rem; cursor: pointer; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="panel">
    <h2>1. æ•¸æ“šä¾†æº</h2>
    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">ğŸ“‚ é»æ“Šä¸Šå‚³ CSV æª”æ¡ˆ</button>
    <input type="file" id="fileInput" accept=".csv" onchange="handleCSV(this)">
</div>

<div class="panel">
    <h2>2. æ•¸æ“šçµ±è¨ˆ</h2>
    <div class="stats-grid">
        <div class="stat-box"><div>è®€å–ç­†æ•¸</div><div class="stat-val" id="readCount">0</div></div>
        <div class="stat-box"><div>å›æ¸¬æ¬¡æ•¸</div><div class="stat-val" id="backCount">0</div></div>
    </div>
</div>

<div class="panel">
    <div class="log-ctrl">
        <h2>3. è¿‘ 30 æœŸå›æ¸¬ Log</h2>
        <select id="stratSel" onchange="updateLog()">
            <option value="mix">å¹³è¡¡æ··åˆ (3ç†±+2å†·)</option>
            <option value="hot">é«˜é »ç†±é–€</option>
            <option value="repeat">é€£èŠå„ªåŒ–</option>
        </select>
    </div>
    <div id="periodRate" style="font-size: 0.75rem; color: var(--cyan); margin-bottom: 5px;">30æœŸå‘½ä¸­ç‡: --</div>
    <table>
        <thead><tr><th>æ—¥æœŸ</th><th>é–‹çè™Ÿ</th><th>å‰ä¸€æ—¥é æ¸¬</th><th>ä¸­</th></tr></thead>
        <tbody id="logBody"></tbody>
    </table>
</div>

<div class="panel">
    <h2>4. ä¸‹æœŸé–‹çé æ¸¬</h2>
    <button id="runBtn" class="main-btn" onclick="renderPredictions()" disabled>ç”Ÿæˆé æ¸¬ç‰Œçµ„</button>
    <div id="stratContainer" style="margin-top: 15px;"></div>
</div>

<script>
    let history = []; 

    function handleCSV(input) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            history = lines.map(line => {
                const cols = line.split(',');
                return { date: cols[0].trim(), nums: cols.slice(-5).map(n => parseInt(n.trim())).filter(n => n >= 1 && n <= 39) };
            }).filter(item => item.nums.length === 5);

            if (history.length > 0) {
                document.getElementById('readCount').innerText = history.length;
                document.getElementById('backCount').innerText = history.length * 3;
                document.getElementById('runBtn').disabled = false;
                updateLog();
                renderPredictions();
            }
        };
        reader.readAsText(input.files[0]);
    }

    // ç´”æ•¸æ“šé‚è¼¯æå– (ä¸å«éš¨æ©Ÿ)
    function getLogicNumbers(type, dataSubset) {
        if (dataSubset.length === 0) return [1,2,3,4,5];
        let counts = {};
        let lastPos = {};
        for(let i=1; i<=39; i++) { counts[i] = 0; lastPos[i] = -1; }
        dataSubset.forEach((item, idx) => {
            item.nums.forEach(n => { counts[n]++; lastPos[n] = idx; });
        });
        const h = Object.entries(counts).sort((a,b) => b[1] - a[1]).map(i => parseInt(i[0]));
        const c = Object.entries(lastPos).sort((a,b) => a[1] - b[1]).map(i => parseInt(i[0]));
        const last = dataSubset[dataSubset.length - 1].nums;

        if (type === 'hot') return h.slice(0, 5);
        if (type === 'mix') return [...h.slice(0, 3), ...c.slice(0, 2)];
        if (type === 'repeat') return [...last.slice(0, 2), ...h.slice(0, 3)];
    }

    function updateLog() {
        const type = document.getElementById('stratSel').value;
        const tbody = document.getElementById('logBody');
        const recent = [...history].reverse().slice(0, 30);
        let hitsCount = 0;

        tbody.innerHTML = recent.map((item, idx) => {
            const dayBeforeIdx = history.length - 1 - idx;
            const prediction = getLogicNumbers(type, history.slice(0, dayBeforeIdx)).sort((a,b)=>a-b);
            const hit = prediction.filter(n => item.nums.includes(n)).length;
            if (hit >= 2) hitsCount++;
            return `<tr><td>${item.date}</td><td>${item.nums.join(',')}</td><td>${prediction.slice(0,2).join(',')}..</td><td class="hit">ä¸­ ${hit}</td></tr>`;
        }).join('');
        document.getElementById('periodRate').innerText = `30æœŸå‘½ä¸­(>2æ˜Ÿ)æ¦‚ç‡: ${((hitsCount/recent.length)*100).toFixed(2)}%`;
    }

    function renderPredictions() {
        const types = [
            { id: 'mix', name: 'å¹³è¡¡æ··åˆ (3ç†±+2å†·)' },
            { id: 'hot', name: 'é«˜é »ç†±é–€ (Top 5)' },
            { id: 'repeat', name: 'é€£èŠå„ªåŒ–ç­–ç•¥' }
        ];
        const container = document.getElementById('stratContainer');
        container.innerHTML = types.map(t => {
            const nums = getLogicNumbers(t.id, history).sort((a,b)=>a-b);
            return `<div class="strat-card">
                <div class="strat-header"><span>${t.name}</span> <span style="color:var(--cyan)">ä¸‹æœŸé æ¸¬</span></div>
                <div class="ball-row">${nums.map(n => `<div class="ball">${n<10?'0'+n:n}</div>`).join('')}</div>
            </div>`;
        }).join('');
    }
</script>
</body>
</html>
