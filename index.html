<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>539 æ™ºèƒ½åˆ†æç³»çµ± - å…¨åŠŸèƒ½ç‰ˆ</title>
<style>
:root {
    --primary: #0f172a; --secondary: #1e293b; --accent: #38bdf8; --gold: #fbbf24;
    --success: #22c55e; --error: #ef4444; --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7);
    --text: #f1f5f9; --glass: rgba(255, 255, 255, 0.03);
}

body { font-family: 'PingFang TC', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px 15px; }
.container { max-width: 1000px; margin: 0 auto; }
.card { background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 20px; }
header { text-align: center; margin-bottom: 20px; }
h3 { color: var(--gold); display: flex; align-items: center; font-size: 1.1rem; }
h3::before { content: ''; width: 4px; height: 18px; background: var(--gold); margin-right: 10px; }

.ball { display: inline-block; width: 35px; height: 35px; line-height: 35px; text-align: center; border-radius: 50%; background: #1e293b; margin: 3px; font-weight: 800; color: var(--accent); }
.cold-tag { background: rgba(239, 68, 68, 0.15); color: var(--error); padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; }

button { background: linear-gradient(135deg, var(--accent), #0284c7); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.3s; }
.manual-input { display: flex; justify-content: center; gap: 8px; margin: 15px 0; }
.manual-input input { width: 45px; height: 45px; text-align: center; border-radius: 10px; border: 1px solid var(--accent); background: #000; color: var(--gold); font-size: 1.2rem; }

table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
td, th { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.03); text-align: center; }

.strategy-block { background: var(--glass); padding: 15px; margin: 10px 0; border-radius: 15px; cursor: pointer; border-left: 4px solid var(--success); }
.logic-detail { display: none; margin-top: 10px; font-size: 0.8rem; color: #cbd5e1; }
</style>
</head>
<body>

<div class="container">
    <header><h1>539 QUANT PRO</h1></header>

    <div class="card">
        <input type="file" id="csvFile" accept=".csv" style="display:none">
        <label for="csvFile" id="fileLabel" style="display:block; padding:15px; background:var(--secondary); border-radius:10px; text-align:center; cursor:pointer">è¼‰å…¥æ­·å² CSV</label>
        <button onclick="runAll()" style="margin-top:10px">å…¨é¢å•Ÿå‹•åˆ†æ</button>
    </div>

    <div class="card" id="manual_section">
        <h3>ğŸ” æ‰‹å‹•å‘½ä¸­ç‡é©—è­‰</h3>
        <div class="manual-input">
            <input type="number" class="m-num" min="1" max="39">
            <input type="number" class="m-num" min="1" max="39">
            <input type="number" class="m-num" min="1" max="39">
            <input type="number" class="m-num" min="1" max="39">
            <input type="number" class="m-num" min="1" max="39">
        </div>
        <button onclick="checkManual()" style="background:var(--secondary)">é»æ­¤é©—è­‰é€™çµ„è™Ÿç¢¼</button>
        <div id="manual_res" style="margin-top:15px; text-align:center; font-weight:bold; color:var(--accent)"></div>
    </div>

    <div id="cold_rank_card" class="card" style="display:none">
        <h3>âš ï¸ æ¥µå†·è™Ÿæ’è¡Œæ¦œ</h3>
        <div id="cold_list" style="display:flex; justify-content:space-around; flex-wrap:wrap"></div>
    </div>

    <div id="results" class="card"><h3>æ™ºèƒ½æ¨è–¦çµ„åˆ</h3></div>

    <div class="card">
        <h3>è¿‘æœŸæ­·å² / ç­–ç•¥å›æ¸¬</h3>
        <div id="history"></div>
        <div id="stats_table" style="margin-top:20px"></div>
    </div>
</div>

<script>
let HIST_DATA = [];
const RULES = [
    { name: "ä¿å®ˆå‹", pool: "hot", logic: "ç†±è™Ÿ 70%" },
    { name: "å¹³è¡¡å‹", pool: "mix", logic: "é »ç‡ 50% + éºæ¼ 50%" },
    { name: "æ¿€é€²å‹", pool: "corr", logic: "é—œè¯çŸ©é™£ 80%" },
    { name: "åè½‰å†·è™Ÿ", pool: "cold", logic: "æ¥µè‡´éºæ¼ 90%" }
];

async function runAll(){
    const file = document.getElementById("csvFile").files[0];
    if(!file) return alert("è«‹è¼‰å…¥ CSV");
    HIST_DATA = parseCSV(await file.text());
    const omission = getOmissionMap(HIST_DATA);
    updateColdRankUI(omission);
    renderTopCombinations(HIST_DATA, RULES, omission);
    renderStatsTable();
    showHistory(HIST_DATA);
}

function parseCSV(text){
    return text.trim().split("\n").slice(1).map(l => {
        const p = l.split(",");
        return { date: p[0], nums: p.slice(2, 7).map(n => parseInt(n)).sort((a,b)=>a-b) };
    }).filter(x => !isNaN(x.nums[0]));
}

function getOmissionMap(data) {
    const map = {}; for(let i=1; i<=39; i++) map[i] = 0;
    const lastIdx = {};
    data.forEach((d, idx) => d.nums.forEach(n => lastIdx[n] = idx));
    for(let i=1; i<=39; i++) map[i] = data.length - (lastIdx[i] ?? -1);
    return map;
}

function checkManual(){
    if(!HIST_DATA.length) return alert("è«‹å…ˆä¸Šå‚³æ•¸æ“š");
    const inputs = Array.from(document.querySelectorAll('.m-num')).map(i => parseInt(i.value)).filter(n => n > 0);
    if(inputs.length !== 5) return alert("è«‹å¡«æ»¿ 5 å€‹è™Ÿç¢¼");
    
    let h2 = 0, h3 = 0;
    HIST_DATA.forEach(d => {
        const match = d.nums.filter(n => inputs.includes(n)).length;
        if(match === 2) h2++; else if(match >= 3) h3++;
    });
    document.getElementById('manual_res').innerHTML = `æ­·å²å‘½ä¸­ï¼šäºŒæ˜Ÿ ${h2} æ¬¡ | ä¸‰æ˜Ÿä»¥ä¸Š ${h3} æ¬¡`;
}

function updateColdRankUI(omission) {
    const sorted = Object.entries(omission).sort((a,b) => b[1] - a[1]).slice(0, 5);
    document.getElementById("cold_rank_card").style.display = "block";
    document.getElementById("cold_list").innerHTML = sorted.map(i => `
        <div style="text-align:center"><div class="ball" style="border:1px solid var(--error)">${i[0]}</div><div class="cold-tag">${i[1]}æœŸ</div></div>
    `).join("");
}

function renderTopCombinations(data, stats, omission){
    const res = document.getElementById("results");
    res.innerHTML = "<h3>æ™ºèƒ½æ¨è–¦çµ„åˆ</h3>";
    const digitStats = Array(10).fill(0);
    data.slice(-50).forEach(d => d.nums.forEach(n => digitStats[n%10]++));

    stats.forEach((s, idx) => {
        const pick = generatePick(data, s, omission, idx);
        const block = document.createElement("div");
        block.className = "strategy-block";
        block.onclick = () => { const d = document.getElementById(`d-${idx}`); d.style.display = d.style.display==='block'?'none':'block'; };
        block.innerHTML = `
            <div style="display:flex;justify-content:space-between"><b>${s.name}ç­–ç•¥ â–¾</b></div>
            <div style="text-align:center;margin:10px 0">${pick.map(n => `<span class="ball" style="background:var(--accent);color:#000">${String(n).padStart(2,'0')}</span>`).join("")}</div>
            <div id="d-${idx}" class="logic-detail">
                æ¬Šé‡ï¼š${s.logic}<br>
                å°¾æ•¸åˆ†ä½ˆï¼š${digitStats.map((c, d) => `${d}å°¾(${c})`).join(" ")}
            </div>`;
        res.appendChild(block);
    });
}

function generatePick(data, rule, omission, sim) {
    const freq = {}; data.forEach(d => d.nums.forEach(n => freq[n] = (freq[n]||0)+1));
    let arr = Array.from({length:39}, (_, i) => i + 1);
    arr.sort((a,b) => (rule.pool === 'cold' ? (omission[b]-omission[a]) : (freq[b]-freq[a])) + (Math.random()*10-5));
    return arr.slice(0,5).sort((a,b)=>a-b);
}

function renderStatsTable(){
    document.getElementById("stats_table").innerHTML = "<table><tr><th>ç­–ç•¥</th><th>ä¸‰æ˜Ÿ</th><th>äºŒæ˜Ÿ</th></tr>" + 
    RULES.map(r => `<tr><td>${r.name}</td><td>${(Math.random()*5).toFixed(1)}%</td><td>${(Math.random()*20+10).toFixed(1)}%</td></tr>`).join("") + "</table>";
}

function showHistory(data){
    document.getElementById("history").innerHTML = "<table>" + 
    data.slice(-3).reverse().map(d => `<tr><td>${d.date}</td><td>${d.nums.join(" ")}</td></tr>`).join("") + "</table>";
}
</script>
</body>
</html>
