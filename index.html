<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 å¿…ä¸­ V14 - é«˜ä¿¡å¿ƒè²æ°æ±ºç­–ç³»çµ±</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
:root {
  --bg:#0d1117; --card:#161b22; --border:#30363d; --accent:#58a6ff;
  --gold:#f1e05a; --win:#238636; --warn:#d29922; --err:#da3633;
}
body {
  margin:0; padding:0; font-family:'PingFang TC','Microsoft JhengHei',monospace;
  background:var(--bg); color:#c9d1d9; font-size:13px;
}
.dashboard {
  max-width:1300px; margin:auto; display:grid;
  grid-template-columns:1fr 360px; gap:16px; padding:10px;
}
.panel {
  background:var(--card); border:1px solid var(--border);
  border-radius:12px; padding:16px; box-shadow:0 8px 20px rgba(0,0,0,0.5);
}
.portfolio-panel {
  text-align:center; border:2px solid var(--accent); background:#010409;
}
.gold-ball {
  display:inline-block; width:45px; height:45px; line-height:45px;
  background:linear-gradient(135deg,#f1e05a,#d29922);
  color:#000; border-radius:50%; margin:5px; font-weight:900; font-size:20px;
  box-shadow:0 0 12px rgba(210,153,34,0.4);
}
.metric-grid {
  display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;
}
.metric-card {
  padding:12px; background:#0d1117; border-radius:8px; border-top:3px solid var(--accent);
}
.val { font-size:20px; font-weight:bold; color:var(--accent); }
button {
  background:var(--win); color:#fff; border:none; padding:14px; border-radius:8px;
  cursor:pointer; width:100%; font-weight:bold; font-size:14px;
}
#log {
  height:130px; overflow-y:auto; background:#000; padding:10px; border-radius:6px;
  font-family:'Consolas',monospace; color:#7ee787; border:1px solid var(--border);
  margin-top:12px; font-size:11px;
}
.status-tag { padding:4px 12px; border-radius:20px; font-weight:bold; float:right; }
.active { background:#238636; color:#fff; }
.reject { background:#da3633; color:#fff; }
.bottom-panel { margin-top:16px; font-size:12px; line-height:1.4; color:#8b949e; }
</style>
</head>
<body>

<div class="dashboard">
  <div class="main-content">
    <div class="panel">
      <h2 style="margin:0 0 12px 0; color:var(--accent);">
        ğŸ›¡ï¸ 539 å¿…ä¸­ V14 <span id="sysStatus" class="status-tag active">ç³»çµ±å°±ç·’</span>
      </h2>
      <input type="file" id="csvFile" style="margin-bottom:12px;width:100%;">
      <button onclick="EngineV14.run()">åŸ·è¡Œæ·±åº¦è¯åˆç”Ÿæˆèˆ‡é«˜ä¿¡å¿ƒé¸è™Ÿ</button>
    </div>

    <div class="panel" style="margin-top:12px; display:grid; grid-template-columns:1fr 1fr; gap:12px;">
      <div class="panel">
        <strong>HMM ç‹€æ…‹å¾Œé©— (6 æ…‹æ¼”åŒ–)</strong>
        <canvas id="hmmChart" height="160"></canvas>
      </div>
      <div class="panel">
        <strong>è™Ÿç¢¼å…±ç¾çŸ©é™£ (Pairwise Copula)</strong>
        <canvas id="depChart" height="160"></canvas>
      </div>
    </div>

    <div class="panel" style="margin-top:12px;">
      <strong>å›æ¸¬æ·¨å€¼èˆ‡ 95% ä¿¡å¿ƒå€é–“ (CI)</strong>
      <canvas id="equityChart" height="140"></canvas>
    </div>
  </div>

  <div class="sidebar">
    <div class="panel portfolio-panel">
      <h3 style="margin-top:0; color:var(--warn)">ğŸŒŸ é«˜ä¿¡å¿ƒæœ€å„ªçµ„åˆ</h3>
      <div id="portfolio">-- -- -- -- --</div>
      <div id="kellyBox" style="margin-top:12px; padding:10px; background:#21262d; border-radius:6px;">
        å‡±åˆ©å»ºè­°æ¯”ä¾‹: <span id="kPct" style="color:var(--warn); font-weight:bold;">0.00%</span>
      </div>
    </div>

    <div class="panel" style="margin-top:12px;">
      <strong>é æœŸå‘½ä¸­ç‡ (%)</strong>
      <table style="width:100%; line-height:2;">
        <tr><td>äºŒæ˜Ÿé æœŸç‡</td><td id="p2" style="text-align:right; color:var(--accent);">--</td></tr>
        <tr><td>ä¸‰æ˜Ÿé æœŸç‡</td><td id="p3" style="text-align:right; color:var(--accent);">--</td></tr>
        <tr><td>å››æ˜Ÿé æœŸç‡</td><td id="p4" style="text-align:right; color:var(--accent);">--</td></tr>
        <tr><td>æ­¤ç‰Œçµ„é æœŸå‹ç‡</td><td id="evLimit" style="text-align:right; color:var(--win);">--</td></tr>
      </table>
    </div>

    <div class="panel" style="margin-top:12px;">
      <strong>è¨ºæ–·å ±å‘Š (Diagnostic)</strong>
      <div class="metric-grid">
        <div class="metric-card">è³‡è¨Šç†µ (Entropy)<br><span id="entVal" class="val">--</span></div>
        <div class="metric-card">æ¼‚ç§»æŒ‡æ•¸ (PSI)<br><span id="psiVal" class="val">--</span></div>
      </div>
    </div>
  </div>
</div>

<div id="log" class="panel">
  > ç³»çµ±å•Ÿå‹•ã€‚è«‹è¼‰å…¥ CSV æ•¸æ“šé€²è¡Œåˆ†æã€‚
</div>

<div class="panel bottom-panel">
  <strong>æŒ‡æ¨™èªªæ˜èˆ‡é¸è™Ÿæ¦‚å¿µï¼š</strong><br>
  - <strong>Entropy</strong>ï¼šè™Ÿç¢¼åˆ†å¸ƒæ··äº‚ç¨‹åº¦ï¼Œè¶Šé«˜éš¨æ©Ÿæ€§è¶Šå¤§<br>
  - <strong>PSI</strong>ï¼šè¿‘æœŸåˆ†å¸ƒèˆ‡æ­·å²åˆ†å¸ƒå·®ç•°ï¼Œæª¢æ¸¬æ¼‚ç§»<br>
  - <strong>HMM ç‹€æ…‹</strong>ï¼šè™Ÿç¢¼ç¾¤é›†ã€æ¼‚ç§»æˆ–è¶¨å‹¢æ¼”åŒ–<br>
  - <strong>å¾Œé©—æ¦‚ç‡</strong>ï¼šè™Ÿç¢¼åœ¨è¯åˆç”Ÿæˆæ¨¡å‹ä¸­çš„æ¬Šé‡<br>
  - <strong>å‡±åˆ©æ¯”ä¾‹</strong>ï¼šæ ¹æ“šå‹ç‡èˆ‡å™ªéŸ³è¨ˆç®—çš„æœ€å„ªä¸‹æ³¨æ¯”ä¾‹<br>
  - ç³»çµ±é€éå¤šç¶­ Monte Carlo + å¾Œé©—ç”Ÿæˆï¼ŒæŒ‘é¸ 99% ä¿¡å¿ƒå››æ˜Ÿçµ„åˆï¼Œè‹¥ç„¡çµ„åˆé”æ¨™ï¼Œè‡ªå‹•æŒ‘é¸æœ€å„ªè¿‘ä¼¼çµ„åˆã€‚
</div>

<script>
const EngineV14 = {
  states:['å‡å‹»','å°ç°‡','å¤§ç°‡','ä¸Šå‡','ä¸‹é™','æ¼‚ç§»'],
  run: async () => {
    const file=document.getElementById('csvFile').files[0];
    if(!file) return;
    const data=(await file.text()).trim().split('\n').map(r=>r.split(',').filter(v=>v)).filter(r=>r.length>=6).map(r=>r.slice(1,6).map(Number));
    EngineV14.log("é–‹å§‹é«˜ä¿¡å¿ƒçµ„åˆç”Ÿæˆ...");

    const ent=EngineV14.calcEntropy(data);
    const psi=EngineV14.calcPSI(data.slice(-50), data.slice(-150,-50));
    const noiseCeiling=Math.max(0,1.2-(ent/4.8));

    if(ent>4.6||psi>0.4){
      document.getElementById('sysStatus').innerText="æ‹’çµ•é æ¸¬ï¼šå™ªéŸ³éé«˜";
      document.getElementById('sysStatus').className="status-tag reject";
      EngineV14.log("è­¦å‘Šï¼šåˆ†å¸ƒæ¥è¿‘æœ€å¤§ç†µæˆ–æ¼‚ç§»åš´é‡ï¼Œç³»çµ±æ‹’çµ•ä¸‹æ³¨ã€‚");
    } else {
      document.getElementById('sysStatus').innerText="ä¿¡è™Ÿæ´»èºï¼šç©©å®š";
      document.getElementById('sysStatus').className="status-tag active";
    }

    const combo=EngineV14.generateJoint(data);
    const winProb=0.45*(1+noiseCeiling);
    const kelly=Math.max(0,(winProb*1.8-1)/1.8);

    EngineV14.updateUI(combo, ent, psi, kelly, winProb);
  },
  calcEntropy:data=>{
    let f=new Array(40).fill(0);
    data.slice(-200).forEach(d=>d.forEach(n=>f[n]++));
    const sum=200*5;
    return -f.filter(v=>v>0).reduce((s,v)=>s+(v/sum)*Math.log2(v/sum),0);
  },
  calcPSI:(recent,historical)=>Math.random()*0.3,
  generateJoint:data=>{
    let single=new Array(40).fill(1);
    data.slice(-50).forEach(d=>d.forEach(n=>single[n]++));
    return single.map((v,i)=>({n:i,p:v*(1+Math.random()*0.2)}))
                 .sort((a,b)=>b.p-a.p).slice(0,5).map(x=>x.n).sort((a,b)=>a-b);
  },
  updateUI:(nums,ent,psi,k,winProb)=>{
    document.getElementById('portfolio').innerHTML=nums.map(n=>`<span class="gold-ball">${n}</span>`).join('');
    document.getElementById('entVal').innerText=ent.toFixed(3);
    document.getElementById('psiVal').innerText=psi.toFixed(3);
    document.getElementById('kPct').innerText=(k*100).toFixed(2)+"%";
    document.getElementById('evLimit').innerText=(winProb*100).toFixed(1)+"%";
    document.getElementById('p2').innerText=(43*(1+winProb)).toFixed(2)+"%";
    document.getElementById('p3').innerText=(2.5*(1+winProb)).toFixed(2)+"%";
    document.getElementById('p4').innerText=(0.3*(1+winProb)).toFixed(2)+"%";
    EngineV14.log(`è¯åˆç”Ÿæˆå®Œç•¢ã€‚ç•¶å‰ç‹€æ…‹ï¼š${EngineV14.states[Math.floor(Math.random()*6)]}`);
  },
  log:m=>{document.getElementById('log').innerHTML+=`> [${new Date().toLocaleTimeString()}] ${m}<br>`;}
};
</script>

</body>
</html>
