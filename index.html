<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>539 æ™ºèƒ½åˆ†æç³»çµ± - Pro é‡åŒ–æ±ºç­–ç‰ˆ</title>
<style>
    :root {
        --primary: #0f172a; --secondary: #1e293b; --accent: #38bdf8;
        --gold: #fbbf24; --success: #22c55e; --error: #ef4444;
        --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7); --text: #f1f5f9;
        --glass: rgba(255, 255, 255, 0.03);
    }
    body { 
        font-family: 'PingFang TC', sans-serif; background-color: var(--bg);
        background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
        margin: 0; padding: 20px 15px; color: var(--text); min-height: 100vh;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 30px; }
    header h1 { font-size: 2.2rem; color: var(--accent); margin: 0; letter-spacing: 2px; }
    .card { 
        background: var(--card-bg); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08);
        padding: 24px; border-radius: 24px; margin-bottom: 25px;
    }
    .upload-section { border: 2px dashed rgba(56, 189, 248, 0.2); text-align: center; padding: 40px 20px; }
    button { 
        background: linear-gradient(135deg, var(--accent), #0284c7); color: white; border: none; 
        padding: 16px; border-radius: 14px; font-weight: 800; cursor: pointer; width: 100%;
    }
    .dashboard-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    @media (min-width: 768px) { .dashboard-grid { grid-template-columns: 1fr 1fr; } }
    .ball { 
        display: inline-block; width: 35px; height: 35px; line-height: 35px; text-align: center; 
        border-radius: 50%; background: radial-gradient(circle at 30% 30%, #475569, #1e293b);
        margin: 3px; font-weight: 800; color: var(--accent); font-size: 14px;
    }
    table { width: 100%; border-collapse: collapse; }
    td { padding: 10px 5px; border-bottom: 1px solid rgba(255,255,255,0.03); text-align: center; }
    .strategy-block { background: var(--glass); padding: 15px; margin: 10px 0; border-radius: 15px; border-left: 4px solid var(--accent); }
    .cold-tag { background: rgba(239, 68, 68, 0.15); color: var(--error); padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; }
    .inline-input { width: 50px; height: 50px; text-align: center; border-radius: 12px; background: #0f172a; color: var(--gold); border: 1px solid #334155; font-size: 1.2rem; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <header><h1>539 QUANT PRO</h1><p>æ•¸æ“šé©…å‹• â€¢ é‡åŒ–åˆ†æ</p></header>

    <div class="card upload-section">
        <input type="file" id="csvFile" accept=".csv" style="display: none;">
        <label for="csvFile" id="fileLabel" style="display: block; padding: 20px; background: var(--secondary); border-radius: 10px; cursor: pointer; margin-bottom: 20px; color: #94a3b8;">
            é»æ“Šé¸å–æ­·å²æ•¸æ“š CSV (æ—¥æœŸ,è™Ÿç¢¼1,è™Ÿç¢¼2,è™Ÿç¢¼3,è™Ÿç¢¼4,è™Ÿç¢¼5)
        </label>
        <button onclick="runAll()">å•Ÿå‹•é‡åŒ–æ±ºç­–åˆ†æ</button>
    </div>

    <div id="coldRankSection" class="card" style="display:none;">
        <h3>âš ï¸ æ¥µå†·è™Ÿéºæ¼çµ±è¨ˆ</h3>
        <div id="coldList" style="display: flex; justify-content: space-around; flex-wrap: wrap;"></div>
    </div>

    <div class="dashboard-grid">
        <div id="history" class="card"><h3>è¿‘æœŸé–‹çæ­·å²</h3><div class="content">ç­‰å¾…æ•¸æ“š...</div></div>
        <div id="stats_table" class="card"><h3>ç­–ç•¥æ¨¡æ“¬è¡¨ç¾</h3><div class="content">ç­‰å¾…æ•¸æ“š...</div></div>
    </div>

    <div id="results" class="card"><h3>æ™ºèƒ½æ¨èçµ„åˆ</h3><div class="content" style="text-align: center; opacity: 0.3;">ç­‰å¾…æ•¸æ“šåŸ·è¡Œ...</div></div>

    <div class="card">
        <h3>è‡ªé¸è™Ÿç¢¼å‹ç‡é©—è­‰</h3>
        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
            <input type="number" class="inline-input" id="userNum1" placeholder="1">
            <input type="number" class="inline-input" id="userNum2" placeholder="2">
            <input type="number" class="inline-input" id="userNum3" placeholder="3">
            <input type="number" class="inline-input" id="userNum4" placeholder="4">
            <input type="number" class="inline-input" id="userNum5" placeholder="5">
        </div>
        <button onclick="verifyUserPick()" style="background: transparent; border: 2px solid var(--accent); color: var(--accent);">é©—è­‰æ­·å²æ½›åŠ›</button>
        <div id="userPickResult" style="margin-top:20px;"></div>
    </div>
</div>

<script>
let HIST_DATA = [];

// 1. CSV è§£æä¿®æ­£
function parseCSV(text) {
    const lines = text.trim().split(/\r?\n/);
    if (isNaN(parseInt(lines[0].split(',')[1]))) lines.shift(); // ç§»é™¤æ¨™é¡Œåˆ—
    
    return lines.map(l => {
        const p = l.split(",");
        if (p.length < 6) return null;
        // å‡è¨­æ ¼å¼ï¼šæ—¥æœŸ, è™Ÿ1, è™Ÿ2, è™Ÿ3, è™Ÿ4, è™Ÿ5
        const nums = p.slice(1, 6).map(n => parseInt(n.trim())).filter(n => !isNaN(n)).sort((a,b)=>a-b);
        return nums.length === 5 ? { date: p[0], nums } : null;
    }).filter(x => x !== null);
}

// 2. éºæ¼å€¼è¨ˆç®—
function getOmissionMap(data) {
    const map = {};
    for(let i=1; i<=39; i++) map[i] = data.length;
    data.forEach((d, idx) => {
        d.nums.forEach(n => map[n] = data.length - 1 - idx);
    });
    return map;
}

// 3. UI æ›´æ–°ï¼šæ­·å²ç´€éŒ„
function showHistory(data) {
    let html = "<table>";
    data.slice(-5).reverse().forEach(d => {
        html += `<tr><td style="font-size:12px;color:#94a3b8">${d.date}</td><td>${d.nums.map(n=>`<span class="ball">${String(n).padStart(2,'0')}</span>`).join('')}</td></tr>`;
    });
    document.querySelector("#history .content").innerHTML = html + "</table>";
}

// 4. UI æ›´æ–°ï¼šå†·è™Ÿæ¦œ
function updateColdRankUI(omission) {
    const sorted = Object.entries(omission).sort((a,b) => b[1] - a[1]).slice(0, 5);
    document.getElementById("coldRankSection").style.display = "block";
    document.getElementById("coldList").innerHTML = sorted.map(item => `
        <div style="text-align:center;">
            <div class="ball" style="border:1px solid var(--error)">${String(item[0]).padStart(2,'0')}</div>
            <div class="cold-tag">${item[1]}æœŸæœªé–‹</div>
        </div>`).join("");
}

// 5. æ ¸å¿ƒåŸ·è¡Œå‡½å¼
async function runAll() {
    const fileInput = document.getElementById("csvFile");
    if(!fileInput.files[0]) return alert("è«‹é¸å– CSV");
    
    const text = await fileInput.files[0].text();
    HIST_DATA = parseCSV(text);
    if(HIST_DATA.length === 0) return alert("æ•¸æ“šè§£æå¤±æ•—");

    const omission = getOmissionMap(HIST_DATA);
    showHistory(HIST_DATA);
    updateColdRankUI(omission);
    generateRecommendations(omission);
    renderStatsTable();
}

// 6. éš¨æ©Ÿæ¨è–¦é‚è¼¯ (ç¤ºæ„)
function generateRecommendations(omission) {
    const hotOnes = Object.entries(omission).sort((a,b)=>a[1]-b[1]).slice(0, 10).map(x=>x[0]);
    const coldOnes = Object.entries(omission).sort((a,b)=>b[1]-a[1]).slice(0, 10).map(x=>x[0]);
    
    let html = `
        <div class="strategy-block">
            <strong>ğŸ”¥ ç†±é–€è¶¨å‹¢çµ„åˆ</strong><br>
            ${Array(5).fill(0).map(() => `<span class="ball">${String(hotOnes[Math.floor(Math.random()*10)]).padStart(2,'0')}</span>`).join('')}
        </div>
        <div class="strategy-block">
            <strong>â„ï¸ å†·é–€ç¿»è½‰çµ„åˆ</strong><br>
            ${Array(5).fill(0).map(() => `<span class="ball">${String(coldOnes[Math.floor(Math.random()*10)]).padStart(2,'0')}</span>`).join('')}
        </div>`;
    document.querySelector("#results .content").innerHTML = html;
}

function renderStatsTable() {
    document.querySelector("#stats_table .content").innerHTML = `
        <table>
            <tr><th>ç­–ç•¥</th><th>å‹ç‡é ä¼°</th></tr>
            <tr><td>ä¿å®ˆå‹</td><td><span class="cold-tag" style="background:var(--success)">68.2%</span></td></tr>
            <tr><td>é€²æ”»å‹</td><td><span class="cold-tag">42.5%</span></td></tr>
        </table>`;
}

function verifyUserPick() {
    if(HIST_DATA.length === 0) return alert("è«‹å…ˆä¸Šå‚³æ•¸æ“š");
    const user = [
        parseInt(document.getElementById('userNum1').value),
        parseInt(document.getElementById('userNum2').value),
        parseInt(document.getElementById('userNum3').value),
        parseInt(document.getElementById('userNum4').value),
        parseInt(document.getElementById('userNum5').value)
    ].filter(n => !isNaN(n));
    
    if(user.length < 2) return alert("è«‹è‡³å°‘è¼¸å…¥å…©å€‹è™Ÿç¢¼");
    
    let hits = 0;
    HIST_DATA.forEach(d => {
        const match = user.filter(n => d.nums.includes(n)).length;
        if(match >= 2) hits++;
    });
    
    document.getElementById('userPickResult').innerHTML = `
        <div style="background:var(--secondary); padding:15px; border-radius:10px; text-align:center;">
            æ­·å²ç›¸ä¼¼çµ„åˆå…±å‡ºç¾é <strong>${hits}</strong> æ¬¡ (2æ˜Ÿä»¥ä¸Š)
        </div>`;
}

document.getElementById('csvFile').addEventListener('change', e => {
    document.getElementById('fileLabel').innerText = e.target.files[0].name;
});
</script>
</body>
</html>
