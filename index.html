<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 ç­–ç•¥é©—è­‰é¢æ¿</title>
    <style>
        :root { --bg: #0a192f; --card: #172a45; --gold: #c5a059; --cyan: #64ffda; --text: #e6f1ff; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { padding: 20px; text-align: center; border-bottom: 1px solid #233554; }
        .header h1 { font-size: 1.1rem; color: var(--gold); margin: 0; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .upload-box { background: rgba(197, 160, 89, 0.05); border: 1px dashed var(--gold); border-radius: 12px; padding: 15px; text-align: center; margin-bottom: 15px; }
        .strategy-card { background: var(--card); border-radius: 16px; padding: 15px; margin-bottom: 12px; }
        .strat-info { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .strat-name { font-weight: bold; color: var(--gold); font-size: 0.9rem; }
        .strat-stats { font-size: 0.75rem; color: var(--cyan); text-align: right; }
        .ball-row { display: flex; gap: 8px; }
        .ball { width: 42px; height: 42px; background: var(--gold); border-radius: 50%; color: var(--bg); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; }
        .footer { padding: 20px; background: var(--bg); }
        .main-btn { width: 100%; padding: 18px; border-radius: 35px; border: none; background: var(--gold); color: var(--bg); font-size: 1rem; font-weight: bold; }
        .main-btn:disabled { background: #333; color: #777; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="header">
    <h1>539 å¼·åŒ–å‹å›æ¸¬ç³»çµ± (å»éš¨æ©ŸåŒ–)</h1>
</div>

<div class="scroll-area">
    <div class="upload-box">
        <label style="cursor: pointer;">ğŸ“‚ è¼‰å…¥æ­·å² CSV é€²è¡Œåˆ†æ<input type="file" accept=".csv" onchange="runAnalysis(this)"></label>
    </div>
    <div id="results"></div>
</div>

<div class="footer">
    <button id="runBtn" class="main-btn" disabled>æ•¸æ“šæœªè¼‰å…¥</button>
</div>

<script>
    let history = [];
    let weights = { freq: {}, lastSeen: {}, tails: {} };

    function runAnalysis(input) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            history = lines.map(l => l.split(',').map(v => parseInt(v.trim())).filter(n => n >= 1 && n <= 39)).filter(a => a.length === 5);
            if (history.length > 0) {
                calculateWeights();
                displayStrategies();
                document.getElementById('runBtn').innerText = "ç­–ç•¥å·²æ ¹æ“šæ•¸æ“šå›ºå®š";
            }
        };
        reader.readAsText(input.files[0]);
    }

    function calculateWeights() {
        // åˆå§‹åŒ– 1-39 æ•¸æ“š
        for(let i=1; i<=39; i++) {
            weights.freq[i] = 0;
            weights.lastSeen[i] = history.length; 
            weights.tails[i%10] = 0;
        }
        // çµ±è¨ˆé »ç‡èˆ‡æœ€å¾Œå‡ºç¾æœŸæ•¸
        history.forEach((draw, idx) => {
            draw.forEach(num => {
                weights.freq[num]++;
                weights.lastSeen[num] = idx; // è¶Šå°ä»£è¡¨è¶Šè¿‘é–‹å‡º
                weights.tails[num%10]++;
            });
        });
    }

    function getStrategyPick(type) {
        let pool = Array.from({length: 39}, (_, i) => i + 1);
        
        if (type === 'HOT') {
            return pool.sort((a,b) => weights.freq[b] - weights.freq[a]).slice(0, 5);
        }
        if (type === 'COLD') {
            // å–æœ€ä¹…æ²’å‡ºçš„ (lastSeen æ•¸å€¼æœ€å¤§çš„)
            return pool.sort((a,b) => weights.lastSeen[b] - weights.lastSeen[a]).slice(0, 5);
        }
        if (type === 'TAIL') {
            // æ‰¾å‡ºæœ€å¼·å°¾æ•¸ï¼Œå–è©²å°¾æ•¸ä¸­é »ç‡æœ€é«˜è€…
            let topTail = Object.entries(weights.tails).sort((a,b) => b[1] - a[1])[0][0];
            return pool.filter(n => n%10 == topTail).sort((a,b) => weights.freq[b] - weights.freq[a]).slice(0, 5);
        }
        if (type === 'MIX') {
            let h = pool.sort((a,b) => weights.freq[b] - weights.freq[a]).slice(0, 3);
            let c = pool.sort((a,b) => weights.lastSeen[b] - weights.lastSeen[a]).filter(n => !h.includes(n)).slice(0, 2);
            return [...h, ...c];
        }
    }

    function backtest(pick) {
        let count2 = history.filter(draw => pick.filter(n => draw.includes(n)).length >= 2).length;
        return ((count2 / history.length) * 100).toFixed(2);
    }

    function displayStrategies() {
        const container = document.getElementById('results');
        container.innerHTML = '';
        const strats = [
            { id: 'HOT', name: 'é«˜é »ç†±é–€ (Top 5 é »ç‡)', desc: 'é¸å–æ­·å²å‡ºç¾æ¬¡æ•¸æœ€å¤šçš„è™Ÿç¢¼' },
            { id: 'COLD', name: 'æ·±å±¤å†·é–€ (éºæ¼è£œå„Ÿ)', desc: 'é¸å–æœ€ä¹…æœªé–‹å‡ºçš„è™Ÿç¢¼' },
            { id: 'TAIL', name: 'å°¾æ•¸å¼·æ”» (æœ€å¼·å°¾æ•¸)', desc: 'æ ¹æ“šæœ€å¼·ç†±é–€å°¾æ•¸é€²è¡Œåˆ†ä½ˆ' },
            { id: 'MIX', name: 'å¹³è¡¡æ··åˆ (3ç†±+2å†·)', desc: 'å…¼é¡§ç†±åº¦èˆ‡å›è£œæ©Ÿç‡' }
        ];

        strats.forEach(s => {
            const pick = getStrategyPick(s.id).sort((a,b) => a-b);
            const rate = backtest(pick);
            container.innerHTML += `
                <div class="strategy-card">
                    <div class="strat-info">
                        <div><div class="strat-name">${s.name}</div><div style="font-size:0.7rem; color:#8892b0">${s.desc}</div></div>
                        <div class="strat-stats">å‘½ä¸­ç‡(>2æ˜Ÿ)<br><span style="font-size:1.1rem">${rate}%</span></div>
                    </div>
                    <div class="ball-row">${pick.map(n => `<div class="ball">${n<10?'0'+n:n}</div>`).join('')}</div>
                </div>`;
        });
    }
</script>
</body>
</html>
